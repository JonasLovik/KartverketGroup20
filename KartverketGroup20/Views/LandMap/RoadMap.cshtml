@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="no">
<head>
    <title>Til lands</title>
    <!-- Bootstrap CSS (for styling, hvis du bruker det) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Egne CSS-filer (juster hvis ikke alle er nødvendige) -->
    <link rel="stylesheet" href="~/css/headerLayoutUser.css" asp-append-version="true">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true">
    <link rel="stylesheet" href="~/css/LandMap&&SjøMap.css" asp-append-version="true">

    <!-- Leaflet CSS (påkrevd for kartet) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- jQuery (påkrevd hvis du bruker modalen og noen jQuery-funksjoner) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

    <!-- Bootstrap JS (påkrevd for modaler og interaktivitet, hvis brukt) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet JS (påkrevd for kartet) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

</head>
<body>

    <header>
        <div class="hovedmeny">
            <div class="logo">
                <a asp-controller="Home" asp-action="Index" class="logo">
                    <img src="~/images/kartverket-logo.jpg" alt="Logo">
                </a>
            </div>
            <button id="mineRegistreringerButton" class="btn btn-secondary">Mine registreringer</button>
            <div id="mineRegistreringer">
                <h5>Mine registreringer</h5>
            </div>
            <div class="menu-container">
                <label>
                    <input type="checkbox" id="menu-toggle">
                    <div class="toggle">
                        <span class="top_line common"></span>
                        <span class="middle_line common"></span>
                        <span class="bottom_line common"></span>
                    </div>
                    <div class="slide">
                        <ul>
                            <li><a asp-action="LandMap" class="menyer-sidebar">Til lands</a></li>
                            <li><a asp-action="SeaMap" class="menyer-sidebar">Til sjøs</a></li>
                            @*await Html.PartialAsync("_LoginPartial")*@
                        </ul>
                    </div>
                </label>
            </div>
        </div>
    </header>

    <div class="top-sub"></div>

    <div>
        <div id="map" style="height: 625px;"></div>
        <div class="registration-container">
            <button id="newRegistrationButton" class="new-registration-btn">
                <span class="button-text">Ny registrering</span>
            </button>
            <div id="menu" class="menu" style="display: none;">
                <a asp-controller="Report" asp-action="Create" id="openModalButton" class="disabled-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                        <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z" />
                    </svg>
                </a>
            </div>
        </div>
    </div>


    <script>
        // Oppsett av kart og lag
        var map = L.map('map', {
            center: [63.00845853670787, 10.136718302965166],
            zoom: 5,
            maxBounds: [[-90, -180], [90, 180]],
        });

        var aerialLayer = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topograatone/default/webmercator/{z}/{y}/{x}.png', {
            attribution: '&copy; <a href="http://www.kartverket.no/">Kartverket</a>'
        });

        var kartverketLayer = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topo/default/webmercator/{z}/{y}/{x}.png', {
            attribution: '&copy; <a href="http://www.kartverket.no/">Kartverket</a>',
            noWrap: true
        });

        L.control.layers({
            "Kartverket Topo": kartverketLayer,
            "Kartverket Grått": aerialLayer
        }).addTo(map);

        kartverketLayer.addTo(map);
        L.control.scale().addTo(map);

        var currentMarker = null;
        var canSetMarker = false;

        // Håndtering av klikk på "Ny registrering"-knappen
        document.getElementById('newRegistrationButton').addEventListener('click', function () {
            var menu = document.getElementById('menu');
            var buttonText = document.querySelector('#newRegistrationButton .button-text');
            var mineRegistreringerButton = document.getElementById('mineRegistreringerButton');
            var mineRegistreringerPanel = document.getElementById('mineRegistreringer');

            if (mineRegistreringerPanel.style.display === 'block') {
                mineRegistreringerPanel.style.display = 'none';
            }

            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
                buttonText.textContent = 'Avbryt';
                mineRegistreringerButton.classList.add('disabled-button');
                mineRegistreringerButton.disabled = true;
                canSetMarker = true;
                document.getElementById('openModalButton').disabled = true;
                document.getElementById('openModalButton').classList.add('disabled-button');
            } else {
                menu.style.display = 'none';
                buttonText.textContent = 'Ny registrering';
                mineRegistreringerButton.classList.remove('disabled-button');
                mineRegistreringerButton.disabled = false;
                canSetMarker = false;
                if (currentMarker) {
                    map.removeLayer(currentMarker);
                }
                document.getElementById('openModalButton').disabled = true;
                document.getElementById('openModalButton').classList.add('disabled-button');
            }
        });

        // Håndtering av kartklikk
        map.on('click', function (e) {
            if (canSetMarker) {
                var lat = e.latlng.lat;
                var lng = e.latlng.lng;

                if (currentMarker) {
                    map.removeLayer(currentMarker);
                }
                currentMarker = L.marker([lat, lng]).addTo(map);

                document.getElementById('openModalButton').disabled = false;
                document.getElementById('openModalButton').classList.remove('disabled-button');
            }
        });

        // Håndtering av klikk på SVG-ikonet
        document.getElementById('openModalButton').addEventListener('click', function () {
            if (!currentMarker) {
                alert("Du må først legge til en markør på kartet.");
                return;
            }
            $('#markerModal').modal('show');
        });

        // Lytter for lukking av modal
        $('#markerModal').on('hidden.bs.modal', function () {
            // Gå tilbake til kartet
            canSetMarker = true;
        });

        // Håndtering av "Mine registreringer"-knappen
        document.getElementById("mineRegistreringerButton").addEventListener("click", function () {
            var panel = document.getElementById("mineRegistreringer");
            panel.style.display = (panel.style.display === "none" || panel.style.display === "") ? "block" : "none";
        });

    </script>

</body>
</html>
